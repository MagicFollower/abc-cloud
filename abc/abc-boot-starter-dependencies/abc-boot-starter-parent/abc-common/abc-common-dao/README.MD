#### abc-common-daoç»„ä»¶æ–‡æ¡£

`æ›´æ–°æ—¶é—´ï¼š2023å¹´08æœˆ10æ—¥ 21:33:03`

---

##### ğŸš€ç‰ˆæœ¬ï¼š0.0.1-SNAPSHOT

- æ”¯æŒtk-mybatisã€æ‹“å±•tk-mybatisæ”¯æŒmysqlçš„æ‰¹é‡æ·»åŠ ä¸æ›´æ–°
  - `AbcTkMapper`
  - `AbcTkGlobalIdGen`ï¼ˆä½¿ç”¨MPä¸­çš„IdWorkerï¼‰
- æ”¯æŒmybatis-plus
  - `AbcMpMapper`
  - `AbcMpService`
  - `AbcMpServiceImpl`
- ğŸ”“é…ç½®æ–‡ä»¶ä½¿ç”¨è¯´æ˜
  - mybatisé»˜è®¤ä¼šè¯»å–çš„xmlï¼š`classpath*:/mapper/**/*.xml`
  - ç”±äºmybatis-pluså’Œtk-mybatisç»“åˆä½¿ç”¨ï¼Œé…ç½®æ–‡ä»¶è¯»å–ä¼˜å…ˆçº§æ–¹é¢ä¼šå­˜åœ¨äº’ç›¸å½±å“ï¼Œè¯¦æƒ…è§æ–‡æ¡£ç»“æŸçš„æ³¨æ„äº‹é¡¹âš ï¸

```yaml
mybatis:
  mapper-locations: ["classpath*:/mapper/**/*.xml"]
  configuration:
    # é»˜è®¤ä¸º true
    map-underscore-to-camel-case: true
    # å…³é—­æ—¥å¿—æ‰“å° org.apache.ibatis.logging.nologging.NoLoggingImpl
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

- ğŸ”“DAOå’ŒDAOxmlå­˜æ”¾ä½ç½®çº¦å®š
  - â‘  DAOå­˜æ”¾åœ¨javaç›®å½•ä¸‹
  - â‘¡ DAOxmlå­˜æ”¾åœ¨resourceä¸‹å’ŒjavaåŒçº§åŒ…è·¯å¾„ä¸‹
  - âš ï¸æ³¨æ„ï¼šå»ºè®®ä½¿ç”¨mybatis-generatorç”ŸæˆEntityå’ŒDAO/DAOxmlï¼

- ğŸ”“å»ºè®®ä½¿ç”¨HikariCPè¿æ¥æ± ï¼ˆ`ä¸‹æ–¹ç»™å‡ºæ¨èç¤ºä¾‹é…ç½®`ï¼‰

```yaml
mybatis:
  # "classpath*:/mapper/**/*.xml"
  mapper-locations: ["classpath*:/mapper/**/*.xml"]
  configuration:
    # é»˜è®¤ä¸º true
    map-underscore-to-camel-case: true
    # å…³é—­æ—¥å¿—æ‰“å° org.apache.ibatis.logging.nologging.NoLoggingImpl
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

spring:
  datasource:
    # type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://192.168.204.101:23306/dev_test?autoReconnect=true&useServerPreparedStmts=true&cachePrepStmts=true&rewriteBatchedStatements=true&allowMultiQueries=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: root
    password: ********************
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      ### æœ€å°ç©ºé—²è¿æ¥ï¼Œé»˜è®¤å€¼10ï¼Œå°äº0æˆ–å¤§äºmaximum-pool-sizeï¼Œéƒ½ä¼šé‡ç½®ä¸ºmaximum-pool-size
      minimum-idle: 10
      ### æœ€å¤§è¿æ¥æ•°ï¼Œå°äºç­‰äº0ä¼šè¢«é‡ç½®ä¸ºé»˜è®¤å€¼10ï¼›å¤§äºé›¶å°äº1ä¼šè¢«é‡ç½®ä¸ºminimum-idleçš„å€¼
      maximum-pool-size: 20
      ### è¿æ¥æ± åç§°ï¼Œé»˜è®¤HikariPool-1
      pool-name: HikariPool-Abc-1
      ### è¿æ¥è¶…æ—¶æ—¶é—´:æ¯«ç§’ï¼Œå°äº250æ¯«ç§’ï¼Œä¼šè¢«é‡ç½®ä¸ºé»˜è®¤å€¼30ç§’
      connection-timeout: 10000
      ### è¿æ¥æµ‹è¯•æŸ¥è¯¢
      connection-test-query: SELECT 1
      ### ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼600000ï¼ˆ10åˆ†é’Ÿï¼‰ï¼Œå¤§äºç­‰äºmax-lifetimeä¸”max-lifetime>0ï¼Œä¼šè¢«é‡ç½®ä¸º0ï¼›ä¸ç­‰äº0ä¸”å°äº10ç§’ï¼Œä¼šè¢«é‡ç½®ä¸º10ç§’ã€‚
      idle-timeout: 600000
      ### è¿æ¥æœ€å¤§å­˜æ´»æ—¶é—´.ä¸ç­‰äº0ä¸”å°äº30ç§’ï¼Œä¼šè¢«é‡ç½®ä¸ºé»˜è®¤å€¼30åˆ†é’Ÿ.è®¾ç½®åº”è¯¥æ¯”mysqlè®¾ç½®çš„è¶…æ—¶æ—¶é—´çŸ­ï¼›å•ä½ms
      max-lifetime: 1800000
      ### è‡ªåŠ¨æäº¤ä»æ± ä¸­è¿”å›çš„è¿æ¥ï¼Œé»˜è®¤å€¼ä¸ºtrue
      auto-commit: true
```







#### âš ï¸ä½¿ç”¨æ³¨æ„äº‹é¡¹

> ç”±äºmybatis-pluså’Œtk-mybatisç»“åˆä½¿ç”¨ï¼Œé…ç½®æ–‡ä»¶è¯»å–ä¼˜å…ˆçº§æ–¹é¢ä¼šå­˜åœ¨äº’ç›¸å½±å“
>
> ğŸ¤”ï¸é—®é¢˜ï¼š`ä¸ºä»€ä¹ˆmybatis-plus-boot-starterå’Œmapper-spring-boot-starteråŒæ—¶é…ç½®æ—¶ï¼Œåªæœ‰mybatis-plusçš„é…ç½®ç”Ÿæ•ˆï¼Œé»˜è®¤mybatisçš„å…¨å±€ä¸ç”Ÿæ•ˆï¼Ÿ`

å½“ä¸¤ä¸ªç»„ä»¶åŒæ—¶é…ç½®æ—¶ï¼Œ`mybatis-plus-boot-starter` ä¸­çš„è‡ªåŠ¨åŒ–é…ç½®é€šå¸¸ä¼šè¦†ç›–æ‰ `mapper-spring-boot-starter` ä¸­çš„é…ç½®ã€‚

å¦‚æœæ‚¨å¸Œæœ›åŒæ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªç»„ä»¶ï¼Œå¹¶ä¸”å¸Œæœ› `mapper-spring-boot-starter` ä¸­çš„ MyBatis é…ç½®ç”Ÿæ•ˆï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š

ç¦ç”¨ `mybatis-plus-boot-starter` çš„è‡ªåŠ¨é…ç½®ï¼š

- åœ¨ä¸»é…ç½®ç±»ï¼ˆé€šå¸¸æ˜¯ `Application` ç±»ï¼‰ä¸Šæ·»åŠ  `exclude` å‚æ•°ï¼Œå¹¶æ’é™¤ `MybatisPlusAutoConfiguration`

- ```java
  @SpringBootApplication(exclude = {MybatisPlusAutoConfiguration.class})
  public class YourApplication {
      // ...
  }
  ```

ä½ å¯èƒ½ä¼šæƒ³ç›´æ¥åœ¨pomä¸­ç§»é™¤abc-common-daoä¸­çš„mpå¯åŠ¨å™¨ä¾èµ–ï¼Œå‘ä¸‹é¢è¿™æ ·â¤µï¸

```xml
<dependency>
    <groupId>com.abc</groupId>
    <artifactId>abc-common-dao</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <exclusions>
        <exclusion>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
        </exclusion>
    </exclusions>
</dependency>
```

è¿™æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ç”±äºTK-MYBATISä¸­IDç”Ÿæˆå™¨ä½¿ç”¨çš„æ˜¯MPä¸­çš„IdWorkerï¼Œæ‰€ä»¥ä½ æ­¤æ—¶éœ€è¦æ‰‹åŠ¨å®ç°ä¸€ä¸ªTK-MYBATISå¯ä»¥ä½¿ç”¨çš„IDç”Ÿæˆå™¨ã€‚

- ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œcommon-daoåŒ…ä¸­å°†mp-starterå’Œmp-coreåˆ†å¼€å¼•å…¥ï¼Œä½ å¯ä»¥ç›´æ¥ç§»é™¤mp-starterä½†æ˜¯è¿˜å¯ä»¥ä½¿ç”¨mp-coreä¸­çš„IdWorkerå’Œå…¶ä»–å·¥å…·â€”â€”`2023å¹´8æœˆ10æ—¥21:30:57`

> ğŸ˜„å…³äºsnowflakeç®—æ³•
>
> Snowflakeç®—æ³•æ˜¯ä¸€ç§åŸºäºæ—¶é—´æˆ³å’Œæœºå™¨IDçš„ç®—æ³•ï¼Œå®ƒå¯ä»¥ç”Ÿæˆå…·æœ‰ä¸€å®šé¡ºåºçš„64ä½é•¿æ•´å‹IDã€‚
>
> Snowflakeç®—æ³•çš„IDç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š
>
> 1. timestampï¼ˆæ—¶é—´æˆ³ï¼‰ï¼š41ä½ï¼Œç²¾ç¡®åˆ°æ¯«ç§’çº§åˆ«ã€‚
> 2. data center IDï¼ˆæ•°æ®ä¸­å¿ƒIDï¼‰ï¼š5ä½ï¼Œç”¨äºæ ‡è¯†ä¸åŒçš„æ•°æ®ä¸­å¿ƒã€‚
> 3. worker IDï¼ˆå·¥ä½œèŠ‚ç‚¹IDï¼‰ï¼š5ä½ï¼Œç”¨äºæ ‡è¯†ä¸åŒçš„å·¥ä½œèŠ‚ç‚¹ã€‚
> 4. sequenceï¼ˆåºåˆ—å·ï¼‰ï¼š12ä½ï¼Œè¡¨ç¤ºåŒä¸€æ¯«ç§’å†…ç”Ÿæˆçš„ä¸åŒIDçš„åºåˆ—ã€‚
>
> é€šè¿‡ç»„åˆä»¥ä¸Šéƒ¨åˆ†ï¼ŒSnowflakeç®—æ³•ä¿è¯äº†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç”Ÿæˆçš„IDçš„å”¯ä¸€æ€§ã€é¡ºåºæ€§å’Œæ—¶é—´æˆ³çš„å¯è¯»æ€§ã€‚

å…³äºMybatisçš„å¸¸ç”¨å…¨å±€é…ç½®é¡¹ï¼š

```yaml
mybatis:
  mapper-locations: ["classpath*:/aaa/**/*.xml"]  # é»˜è®¤ä¸ºclasspath:/mapper/*.xml
  type-aliases-package: com.example.your-package.dal.entity  # æ— é»˜è®¤å€¼
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl  # é»˜è®¤o.a.i.l.nologging.NoLoggingImpl
    map-underscore-to-camel-case: false  # é»˜è®¤ä¸ºtrue
    jdbc-type-for-null: null  # é»˜è®¤other
```



























***<u>END.</u>***
