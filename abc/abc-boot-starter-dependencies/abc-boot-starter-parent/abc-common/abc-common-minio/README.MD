#### abc-common-minioç»„ä»¶æ–‡æ¡£

---

##### ğŸš€ç‰ˆæœ¬ï¼š0.0.1-SNAPSHOT

- minioå®˜æ–¹å¹¶æ²¡æœ‰æä¾›spring-bootçš„å¯åŠ¨å™¨ï¼Œå¦‚æœåˆ©ç”¨springbootè‡ªåŠ¨è£…é…çš„ç‰¹æ€§ï¼Œéœ€è¦äºŒæ¬¡å°è£…ï¼›
- æœ¬ç‰ˆæœ¬ç»„ä»¶å°è£…æ”¯æŒ`å•èŠ‚ç‚¹Minio`
- å¯¹å¤–æš´éœ²é…ç½®å‚æ•°å¦‚ä¸‹

```yaml
minio:
	endpoint: 192.168.204.101:9090
	accessKey: *******
	secretKey: **************
	bucketName: exampleBucket
```

- `SpringIOCå®¹å™¨`ä¸­æ³¨å…¥`MinioService`å¯¹è±¡ï¼Œæä¾›å°è£…åçš„æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ç­‰APIã€‚

```conf
List<Bucket> getAllBuckets() throws MinioException 
boolean bucketExists(String bucketName) throws MinioException 
boolean addBucket(String bucketName) throws MinioException 
boolean removeBucket(String bucketName) throws MinioException 
```

```conf
List<Item> listObjects() throws MinioException   // è·å–springbooté…ç½®çš„bucketNameä¸­æ‰€æœ‰å¯¹è±¡
```

```conf
String upload(MultipartFile file) throws MinioException  // è¿”å›ä¸Šä¼ æ–‡ä»¶å
void download(String fileName, HttpServletResponse res) throws MinioException // è‡ªå®šä¹‰ä¸‹è½½
String preview(String fileName) throws MinioException  // é¢„è§ˆurl
boolean remove(String fileName) throws MinioException  // åˆ é™¤æ–‡ä»¶
```

âš ï¸æ³¨æ„ï¼š

- è¿™é‡Œçš„`MinioException`æ˜¯<u>`minio`å®˜æ–¹çš„å¼‚å¸¸ï¼ˆç»§æ‰¿è‡ªExceptionï¼‰</u>ï¼Œéœ€è¦ç”¨æˆ·åœ¨ç¨‹åºä¸­æ˜¾å¼æ•è·å¹¶å¤„ç†ã€‚`Exception` å’Œ`RuntimeException` ä¸åŒï¼Œåè€…ä¸å¼ºåˆ¶åœ¨ç¨‹åºä¸­æ˜¾å¼æ•è·å¤„ç†ã€‚

- å½“å‰ç»„ä»¶æä¾›äº†webç¯å¢ƒä¸‹å•æ–‡ä»¶çš„ä¸Šä¼ ï¼ˆ`MultipartFile`ï¼‰ï¼Œå¤šæ–‡ä»¶ä¸Šä¼ è¯·åœ¨ä¸šåŠ¡é€»è¾‘ä¸­æ‰‹åŠ¨æ§åˆ¶ã€‚
  - ä¸Šä¼ å¤šä¸ªæ–‡ä»¶æœ‰å¤šç§å®ç°ï¼š1. å¤šä¸ªæ–‡ä»¶ä¸Šä¼ ï¼›2.å¤šä¸ªæ–‡ä»¶æ‰“åŒ…ä¸Šä¼ ã€‚

âš ï¸ä½¿ç”¨çº¦å®šï¼š

- è¯·ä¸è¦å†ä¸šåŠ¡é€»è¾‘ä¸­éšæ„åˆ›å»º/åˆ é™¤Bucketï¼Œä¸Šä¼ æ–‡ä»¶/ä¸‹è½½æ–‡ä»¶ä¼šé»˜è®¤ä½¿ç”¨`springbooté…ç½®æ–‡ä»¶` ä¸­çš„bucketã€‚

âš ï¸å…³äºæ–‡ä»¶ä¸‹è½½APIï¼š

- å¡«å……Content-Lengthè¯·æ±‚å¤´ â†’ æ•°æ®å¤§å°
  - Axioså¯ä½¿ç”¨è¯¥è¯·æ±‚å¤´å®ç°è¿›åº¦æ¡
- <u>æ–°å¢File-Nameè¯·æ±‚å¤´ â†’ æ–‡ä»¶å</u>
- <u>æ–°å¢File-Typeè¯·æ±‚å¤´ â†’ æ–‡ä»¶ç±»å‹ï¼ˆContent-Typeï¼‰</u>

â¬‡ï¸

ä½¿ç”¨å½“å‰ä¸‹è½½æ¥å£ï¼Œä½ å¯ä»¥åŒæ—¶å®ç°å‰ç«¯é¢„è§ˆå’Œä¸‹è½½åŠŸèƒ½ï¼š

> ç¤ºä¾‹ä½¿ç”¨Axios

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>æ–‡ä»¶é¢„è§ˆ</title>
    <script src="./axios.min.js"></script>
    <script>
        function previewFile() {
            let axios1 = axios.create({
                baseURL: 'http://127.0.0.1:9091',
                timeout: 30000,
                headers: {
                    'Content-Type': 'application/json; charset=utf-8'
                }
            });
            // ä»åå°è·å–æ•°æ®
            axios1.get('/images/download_s', {
                responseType: 'blob'
            }).then(res => {
                let url = window.URL.createObjectURL(new Blob([res.data], {'type': res.headers['file-type']}));
                window.open(url);
                window.URL.revokeObjectURL(url)
            });
        }
    </script>
</head>
<body>

<button onclick="previewFile()">é¢„è§ˆæ–‡ä»¶</button>
</body>
</html>
```

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>æ–‡ä»¶ä¸‹è½½</title>
    <script src="./axios.min.js"></script>
    <script>
        function downloadFile() {
            let axios1 = axios.create({
                baseURL: 'http://127.0.0.1:9091',
                timeout: 30000,
                headers: {
                    'Content-Type': 'application/json; charset=utf-8'
                }
            });
            // ä»åå°è·å–æ•°æ®
            axios1.get('/images/download_s', {
                responseType: 'blob'
            }).then(res => {
                let url = window.URL.createObjectURL(new Blob([res.data], {'type': res.headers['file-type']}));
                let a = document.createElement('a');
                a.href = url;
                a.download = res.headers['file-name'];
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            });
        }
    </script>
</head>
<body>

<button onclick="downloadFile()">ä¸‹è½½æ–‡ä»¶</button>
</body>
</html>
```

